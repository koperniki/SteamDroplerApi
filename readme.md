
### Конфигурация 
Конфиграция упрощена:

* Убраны настройки вермени фарма и простоя между фармом
* Разделены основной конфиг и конфиг с рабочими данными (см Configs/Accounts/Run).

Настройка конфигурации

В дериктории с исполняемым файлов нужно создать (если не создана ранее) следующую струтуру файлов

 * Configs/MainConfig.json
 * Confgis/Accounts/\<accountName\>.json

 где:
 
MainConfig.json файл основной конфигурации следующего содержания:
 ``` json
 {
    "StartTimeOut": 30,
    "CoolDownAfterLoginError": 120,
    "DropConfig" : [
        {
            "GameId":232090,
            "DropItemIds": [910000, 90000]
        },
        {
            "GameId":252490,
            "DropItemIds": [10]
        },
    ]
 }
 ```
 <details>
 <summary>Описание полей</summary>

  * StartTimeOut: время задержки между запусками аккаунтов на фарм в секундах
  * CoolDownAfterLoginError: время задержки между запусками аккаунтов на фарм после ошибки авторизации в секундах
  * DropConfig: описание идентификаторов дропа
    * GameId: идентификатор приложения
    * DropItemIds: список идентификаторов генераторов дропа

 </details>


 \<accountName\>.json файл конфигурации одного аккаунта steam следующего содержания:
 ``` json
{
  "Password": "pass",
  "IdleEnable": true,
  "SharedSecret" : "secret",
  "AuthType": "WithSecretKey"
}

 ```
 <details>
 <summary>Описание полей</summary>

  * accountName: login аккаунта
  * Password: пароль от аккаунта
  * IdleEnable: активен ли бот
  * SharedSecret: секрет из .maFile
  * AuthType: тип аутентификации  (пока что всегда через SecretKey)
   
 </details>

 В ходе работы приложения будут созданы следующие директории 

 * logs: директория с файлами логов, дублирующй вывод на консоль (для анализа или для передачи в отладку)
 * Configs/Accounts/Run: директория с динамическими данными сформированными во время запуска процесса фарма по каждому аккаунту(если есть необходимость сбросить состояние аккаунта, можно удалить файл из этой папки)

### Процесс работы 

Для старта необходимо запустить основной исполняемый файл SteamDroplerApi(.exe). 
 * Считывается MainConfig.json. Если данного файла нет, или файл содержит ошибки, будет выведенно предупреждение и программа будет завершена
 * Считаются файлы конфигурации аккаунтов. Если файлs будут повреждены, будет выведенно предупреждение, система продолжит работу с валидными аккаунтами
 * С переодичностью в 30 секнуд будут запускатся дочерние процессы SteamDroplerApi.Worker(.exe) непосредственно с логикой фарма.

 <details>
 <summary>Обоснование</summary>

 Данное решение потребляет больше ресурсов (RAM, CPU), но 

  * Падение 1 процесса не повлияет на фарм других аккаунтов
  * Возможно подключение proxy (TODO)
  * Отпадает необходимость дублировать дроплер по папками с ~200 аккаунтов
 </details>

  * Запускается api для взаимодействия с аккаунтами.
 
   

### Взаимодействие через Api

По умолчанию, для работы приложения не требуется взаимодействияс ним. Но для оптимизации настройки конфигов и для отслеживания состояния аккаунтов было добавленно api.

Для получения информации по api, после запуска приложения нужно будет перейти по адрессу http://localhost:7832/swagger/index.html  (в случае наличия браузера). В данном интерфейсе можно будет выполнять запросы напрямую. Если барузера нет, то запросы можно выполнять через curl|postman 

Api:
 * /api/Account/get - возвращает список аккаунтов с их текущим состоянием
 * /api/Licensing/addApps - добавить всем аккаунтам free License по appId
 * /api/Licensing/addPackage - добавить всем аккаунтов игру по packageId

 Список api будет расширяться

### Todo //

<input type="checkbox" disabled /> вывод дропа и состояния аккаунтов в google таблицы чтоб можно было мониторить состояние онлайн

<input type="checkbox" disabled /> расширение api
 * включение/выключение бота
 * изменение конфига дропа
 * ченить еще, хз


<input type="checkbox" disabled /> поддрежка proxy и porxy листы